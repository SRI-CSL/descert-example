FROM gradle:6.7.1-jdk8-hotspot

# install basics
RUN cd ~ ; git clone https://github.com/SRI-CSL/daikon-gradle-plugin.git dgp
RUN cd ~/dgp ; ./gradlew clean; ./gradlew build; ./gradlew publishToMavenLocal


COPY . /usr/local/src/descert-example
WORKDIR /usr/local/src/descert-example

RUN ./gradlew clean
RUN ./gradlew build
# RUN ./gradlew runDaikon


# Status
# command daikon.DynComp --output_dir=../../../../../daikon-output \
#  	--ppt-select-pattern=com.foo.AutoGeneratedTestDriver \
#   --ppt-select-pattern=com.foo.FooStuffTest com.foo.AutoGeneratedTestDriver
# throws the following error:
# Error occurred during initialization of VM
# java.lang.UnsatisfiedLinkError: sun.misc.Unsafe.isBigEndian0()Z
# 	at sun.misc.Unsafe.isBigEndian0(Native Method)
# 	at sun.misc.Unsafe.<clinit>(Unsafe.java:1233)
# 	at sun.misc.SharedSecrets.<clinit>(SharedSecrets.java:48)
# 	at java.lang.ref.Reference.<clinit>(Reference.java:235)
# FYI Working directory: /usr/local/src/descert-example/build/classes/java/test/com/foo